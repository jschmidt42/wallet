<?xml version="1.0" encoding="UTF-8"?>


<!-- 
  Copyright 2023 Wiimag Inc. All rights reserved.
  License: https://equals-forty-two.com/LICENSE
-->

<!-- Build: /c/Tools/wix311-binaries/candle.exe resources/setup.wxs -out artifacts/installer/wallet.wixobj -->
<!-- Link: /c/Tools/wix311-binaries/light.exe artifacts/installer/wallet.wixobj -out artifacts/installer/wallet.msi -->

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" 
    Language="1033" 
    Name="@PRODUCT_NAME@" 
    Version="@VERSION_MAJOR@.@VERSION_MINOR@.@VERSION_PATCH@" 
    Manufacturer="@PRODUCT_COMPANY@" 
    UpgradeCode="7d3968ea-758a-4d6d-a453-5a55525e1911">

    <Package InstallerVersion="300" Compressed="yes" InstallScope="perUser" />
    <MediaTemplate EmbedCab="yes" />
    
    <!-- Setup upgrade rules -->
    <MajorUpgrade 
        AllowDowngrades="no"
        AllowSameVersionUpgrades="yes"
        DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

    <!-- Setup icon -->
    <Icon Id="SetupIcon" SourceFile="resources\main.ico" />
    <Property Id="ARPPRODUCTICON" Value="SetupIcon" />

    <Directory Id="TARGETDIR" Name="SourceDir">
        <Directory Id="DesktopFolderUser" Name="Desktop"/>
        <Directory Id="LocalAppDataFolder">
          <Directory Id="INSTALLFOLDER" Name="@PRODUCT_NAME@" />
        </Directory>
    </Directory>

    <!-- Remove installation folder on uninstall -->
    <DirectoryRef Id="INSTALLFOLDER">
        <Component Id="RemoveFolder" Guid="055f61f5-4752-4d28-8549-881f8cc181f1">
            <RemoveFolder Id="INSTALLFOLDER" On="uninstall"/>
            <RegistryValue Root="HKCU" Key="Software\[Manufacturer]\[ProductName]" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
        </Component>
    </DirectoryRef>

    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
      <Component Id="@PROJECT_ID@.exe" Guid="18d0223c-67d0-42a1-9866-ebb1f2bb49e9">
        <File Id="@PROJECT_ID@.exe" Source="build\@PROJECT_ID@.exe" />
        
        <!-- Add shortcut exe on Desktop -->
        <Shortcut
          Id="DesktopShortcut"
          Directory="DesktopFolderUser"
          Name="@PRODUCT_NAME@"
          WorkingDirectory="INSTALLFOLDER" />

        <!-- Use registry key under HKCU as the KeyPath -->
        <RegistryValue
          Root="HKCU"
          Key="Software\[Manufacturer]\[ProductName]"
          Name="installed"
          Type="integer"
          Value="1"
          KeyPath="yes" />

      </Component>
    </ComponentGroup>

    <Feature Id="ProductFeature" Title="@PRODUCT_NAME@" Level="1">
        <ComponentGroupRef Id="ProductComponents" />
        <ComponentRef Id="RemoveFolder" />
    </Feature>

    <CustomAction Id="EXECUTE_AFTER_FINALIZE"                  
              Execute="immediate" 
              Return="asyncNoWait"
              FileKey="@PROJECT_ID@.exe"
              ExeCommand="" />

    <InstallExecuteSequence>
      <Custom Action="EXECUTE_AFTER_FINALIZE" After="InstallFinalize">NOT Installed</Custom>
      <InstallInitialize />
      <InstallFinalize />
    </InstallExecuteSequence>

  </Product>
</Wix>